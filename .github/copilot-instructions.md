<!-- Copilot / AI agent instructions for the Snibbl (storygram) repo -->
# Quick onboarding for AI coding agents

This file contains the essential, repo-specific knowledge an AI coding agent needs to be productive working on Snibbl (`storygram`). Keep changes minimal and reference the exact files mentioned.

1) Big picture
- **Tech stack**: Flutter app (Dart SDK >= 3.10), Firebase (Auth, Firestore, Storage, Messaging), Riverpod for state management.
- **High-level layout**: `lib/` is organized into `core/`, `features/`, `global_providers/`, `screens/`, `widgets/`.
- **Feature pattern**: each feature folder typically contains `presentation/` (UI), `providers/` (Riverpod providers), optionally `data/` and `helpers/`.

2) Initialization & entry points
- App entry: `lib/main.dart` — initializes Firebase (`DefaultFirebaseOptions`) and wraps app in `ProviderScope`.
- Routes are declared in `main.dart` (examples: `/`, `/loginScreen`, `/mainScreen`, `/homeScreen`). Use the `navigatorKey` from `main.dart` when you need global navigation in injected code.
- Firebase options file: `lib/firebase_options.dart` (generated by FlutterFire CLI). Do not hardcode alternative Firebase setup without checking this file.

3) Key integration points and services
- Firebase usage: `firebase_auth`, `cloud_firestore`, `firebase_messaging`, `firebase_core`. Android `google-services.json` is present in `android/app/` — iOS plist must be placed into Xcode project when iOS changes are made.
- Core services: `lib/core/services/` includes `auth_services.dart`, `upload_post_service.dart`, `user_services.dart` — these are authoritative places for business logic interacting with Firebase.
- UI and state: presentation widgets live under `features/*/presentation/`, and state lives in `features/*/providers/` or `global_providers/` using Riverpod. Prefer updating providers rather than manipulating state inside widgets.

4) Project conventions and patterns (examples)
- Naming: provider files use `_provider` in their name (e.g., `auth_providers.dart`, `post_provider.dart`).
- Folder structure per feature: `features/<feature>/presentation/...`, `features/<feature>/providers/...`, and `features/<feature>/helpers/...` when needed.
- Small reusable widgets are kept under `lib/widgets/` or `features/<feature>/presentation/widgets/`.

5) Build / run / debug workflows (Windows / PowerShell)
- Install deps: `flutter pub get`
- Run app locally (default device):
```
flutter pub get
flutter run
```
- Run tests: `flutter test` (project contains a `test/widget_test.dart` file).
- Firebase reconfiguration: use the FlutterFire CLI to regenerate `lib/firebase_options.dart` if Firebase project settings change.

6) When editing code, prefer:
- Update or add Riverpod providers for state changes (see `features/auth/providers/auth_providers.dart`).
- Keep UI (presentation widgets) declarative and thin — push logic into `core/services` or providers.
- Reuse `/core/themes` and `core/constants/assets.dart` when adding new styling or assets.

7) Files to inspect for context (quick reference)
- `lib/main.dart` — routes, `ProviderScope`, `DefaultFirebaseOptions` usage
- `lib/firebase_options.dart` — Firebase configuration
- `lib/core/services/*` — Firebase interactions and business logic
- `lib_structure.txt` — human-readable map of `lib/` layout
- `pubspec.yaml` — dependency versions (Riverpod, Firebase, Google Sign-In, etc.)

8) Safety and data handling
- Firebase keys in `firebase_options.dart` are present; do not leak additional secrets into source. For platform-specific keys, verify presence of `google-services.json` (Android) and `GoogleService-Info.plist` (iOS) before building.

9) Helpful examples / snippets
- Initialize Firebase (already in `main.dart`):
```
await Firebase.initializeApp(options: DefaultFirebaseOptions.currentPlatform);
runApp(ProviderScope(child: MyApp()));
```
- Typical provider location: `features/posts/providers/post_provider.dart` — look here for post-related flows (likes, saves, comments).

10) If you modify CI, linting, or formatting
- The repo uses `flutter_lints` — match existing lint style in `analysis_options.yaml`.

If anything in this file is unclear or you want more details about a particular feature, tell me which area to expand (e.g., auth flows, Firestore schemas, or navigation).
